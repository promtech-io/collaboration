{"swagger":"2.0","x-id":["promtech.monorepo.nebula.router/ws-public","promtech.monorepo.nebula.router/did","promtech.monorepo.nebula.router/swagger","promtech.monorepo.nebula.router/api","promtech.monorepo.nebula.router/ws-protect"],"info":{"title":"nebula","description":"nebula"},"securityDefinitions":null,"paths":{"/api/secret-key":{"post":{"responses":{"default":{"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"username":{"type":"string"},"password":{"type":"string"}},"required":["username","password"]}}],"summary":"获取secret-key","tags":["rest api endpoint"]}},"/api/device/qr-code":{"get":{"responses":{"200":{"schema":{"type":"object","properties":{"qr_code":{"type":"string"}},"required":["qr_code"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"device secret-key","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"ws-info":{"type":"string"}},"required":["ws-info"]}}],"summary":"设备获取二维码的message","tags":["rest api endpoint"]}},"/api/role/auth":{"get":{"responses":{"200":{"schema":{"type":"object","properties":{"symmetric_key":{"type":"string"},"role_did_token":{"type":"string"}},"required":["symmetric_key","role_did_token"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""},"403":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"secret_key":{"type":"string"},"code":{"description":"ws 收到的code","type":"string"}},"required":["secret_key","code"]}}],"summary":"设备+医生登陆","tags":["rest api endpoint"]}},"/api/role/grant":{"post":{"responses":{},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"message":{"type":"string"},"signature":{"type":"string"},"role_did_token":{"type":"string"},"P":{"type":"string"}},"required":["message","signature","role_did_token","P"]}}],"summary":"医生did客户端提交用于设备的role-did-token","tags":["rest api endpoint"]}},"/api/request/approve":{"post":{"responses":{"200":{"description":""},"401":{"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"message":{"type":"string"},"signature":{"type":"string"},"P":{"description":"personal-P","type":"string"}},"required":["message","signature","P"]}}],"summary":"病人提交附加同意的request-message及签名","tags":["rest api endpoint"]}},"/api/{did}/record":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"data":{"type":"string"}},"required":["data"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"path","name":"did","description":"","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"request_code":{"type":"string"},"secret_key":{"type":"string"}},"required":["request_code","secret_key"]}}],"summary":"获取病人病历","tags":["rest api endpoint"]}},"/api/ds/request/create":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"request_message":{"type":"string"}},"required":["request_message"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"requester_P":{"description":"申请者（医生）的personal-P + role-P)","type":"string"},"requestee_P":{"description":"被申请者（病人）的personal-P","type":"string"},"scope":{"description":"todo","type":"string"}},"required":["requester_P","requestee_P","scope"]}}],"summary":"创建用于签名的request-message","tags":["rest api endpoint"]}},"/api/ds/request/submit":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"request-code":{"type":"string"}},"required":["request-code"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"request_message":{"description":"","type":"string"},"signature":{"description":"","type":"string"},"role_P":{"description":"","type":"string"}},"required":["request_message","signature","role_P"]}}],"summary":"获取医生签名的request-message并返回request-code","tags":["rest api endpoint"]}},"/api/ds/request/approve":{"post":{"responses":{"200":{"schema":null,"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"request_message":{"description":"包括用户同意状态的request-message","type":"string"},"signature":{"description":"","type":"string"},"personal_P":{"description":"","type":"string"}},"required":["request_message","signature","personal_P"]}}],"summary":"病人在医生的reqeust-message添加同意并签名","tags":["rest api endpoint"]}},"/ws/device/info":{"get":{"responses":{"200":{"schema":{"type":"object","properties":{"ws-id":{"type":"string"}},"required":["ws-id"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[],"summary":"获取websocket的基础信息","tags":["websocket endpoint"]}},"/did/register":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"pub_key":{"type":"string"}},"required":["pub_key"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"api-key","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"email":{"type":"string"},"pin":{"type":"string"},"user":{"type":"object","properties":{"name":{"type":"string"},"hostpital":{"type":"string"},"department":{"type":"string"}},"required":["name","hostpital","department"]}},"required":["email","pin","user"]}}],"summary":"did用户注册","tags":["did system endpoint"]}},"/did/login":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"token":{"type":"string"},"personal_P":{"type":"string"},"user":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"},"hospital":{"type":"string"},"department":{"type":"string"},"roles":{"type":"array","items":{},"x-items":[{"type":"string"}]}},"required":["id","name","hospital","department","roles"]}},"required":["token","personal_P","user"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"api-key","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"email":{"type":"string"},"pin":{"type":"string"}},"required":["email","pin"]}}],"summary":"did用户登陆，获取did_token","tags":["did system endpoint"]}},"/did/role_token":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"role_did_token":{"type":"string"}},"required":["role_did_token"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"did-token","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"message":{"type":"string"},"signature":{"type":"string"},"role":{"type":"string"}},"required":["message","signature","role"]}}],"summary":"根据医生选择的role发放token","tags":["did system endpoint"]}},"/did/random-message":{"get":{"responses":{"200":{"schema":{"type":"object","properties":{"random-message":{"type":"string"}},"required":["random-message"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"role-did-token or did-token","type":"string","required":true}],"summary":"did 生成random message","tags":["did system endpoint"]}},"/did/signature":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"message":{"type":"string"},"signature":{"type":"string"}},"required":["message","signature"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"did-token","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"message":{"description":"需要签名的message","type":"string"}},"required":["message"]}}],"summary":"did 根据personal-P签名","tags":["did system endpoint"]}},"/did/role/signature":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"message":{"type":"string"},"signature":{"type":"string"}},"required":["message","signature"]},"description":""},"401":{"schema":{"type":"object","properties":{"error":{"type":"string"}},"required":["error"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"role-did-token","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"message":{"description":"需要签名的message","type":"string"}},"required":["message"]}}],"summary":"did 根据role-P签名","tags":["did system endpoint"]}},"/did/verify":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"status":{"type":"boolean"}},"required":["status"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"api-key","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"message":{"description":"消息","type":"string"},"signature":{"description":"消息对应的签名","type":"string"},"P":{"description":"消息签署者的公钥","type":"string"}},"required":["message","signature","P"]}}],"summary":"did 签名验证","tags":["did system endpoint"]}},"/did/decrypt":{"post":{"responses":{"200":{"schema":{"type":"object","properties":{"data":{"type":"string"}},"required":["data"]},"description":""}},"produces":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"consumes":["application/json","application/transit+msgpack","application/transit+json","application/edn"],"parameters":[{"in":"header","name":"authorization","description":"nebula-api-key","type":"string","required":true},{"in":"body","name":"body","description":"","required":true,"schema":{"type":"object","properties":{"data":{"description":"加密病历消息","type":"string"},"message":{"description":"消息","type":"string"},"signature":{"description":"消息对应的签名","type":"string"},"P":{"description":"消息签署者的公钥","type":"string"}},"required":["data","message","signature","P"]}}],"summary":"did 解密病历消息","tags":["did system endpoint"]}}}}